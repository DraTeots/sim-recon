void c_eff_pol2(void)
{
// macro that gets TGraphs from the ROOT file generated from the BCAL_point_calibs plugin and returns the effective velocities for each channel, using a quadratic fit

#include <TRandom.h>

gROOT->Reset();

	// change this to the location and name of your own ROOT file
        TFile *in = new TFile("../hd_bcal_point_calibs_oct_2016_test.root","READ");

	// histogram to hold the effective velocities
        TH1D* h1_c_eff2 = NULL;

	// histogram to hold the p2 fit parameter
        TH1D* h1_p2_fit_parameter = NULL;

	// function to hold the fit results
        TF1* func2 = NULL;

	// graph for storing the graphs returned from the ROOT file
        TGraph* h2_tgraph = NULL;

        h1_c_eff2 = new TH1D("h1_c_eff2","Effective Velocity per Channel",800,0,800);
        h1_c_eff2->SetXTitle("Channel #");
        h1_c_eff2->SetYTitle("Effective Velocity (cm/ns)");
        h1_c_eff2->GetYaxis()->SetRangeUser(15,19);
        h1_c_eff2->SetMarkerStyle(20);
        h1_c_eff2->SetOption("E1");


        h1_p2_fit_parameter = new TH1D("h1_p2_fit_parameter", "p2 fit parameter", 800, 0, 800);
        h1_p2_fit_parameter->SetXTitle("Channel #");
        h1_p2_fit_parameter->SetYTitle("p2 fit parameter (cm^{-1)");
        h1_p2_fit_parameter->SetMarkerStyle(20);
        h1_p2_fit_parameter->SetOption("E1");

        int channels = 768;

	// use this if you want the old effective velocity value
        // double effective_velocity = 16.75;

        double effective_velocity[768] = {16.4146,
					16.40973,
					16.4242,
					16.41166,
					16.74414,
					16.71306,
					16.74546,
					16.72644,
					17.372,
					17.38354,
					17.36847,
					17.3699,
					18.41634,
					18.46365,
					18.48471,
					18.48894,
					16.41432,
					16.43936,
					16.44695,
					16.44065,
					16.75203,
					16.7739,
					16.8043,
					16.79895,
					17.39148,
					17.41242,
					17.40693,
					17.44526,
					18.50205,
					18.49835,
					18.55007,
					18.50524,
					16.40412,
					16.39686,
					16.40029,
					16.4036,
					16.7121,
					16.74587,
					16.74676,
					16.74656,
					17.37471,
					17.39561,
					17.36324,
					17.37274,
					18.50845,
					18.4791,
					18.51249,
					18.49867,
					16.43865,
					16.40073,
					16.42324,
					16.4289,
					16.75077,
					16.74732,
					16.75559,
					16.77446,
					17.37139,
					17.42648,
					17.36393,
					17.37014,
					18.43441,
					18.41751,
					18.45149,
					18.47392,
					16.3943,
					16.40885,
					16.39406,
					16.40122,
					16.73505,
					16.74169,
					16.7192,
					16.7253,
					17.35672,
					17.3933,
					17.35043,
					17.38013,
					18.47009,
					18.45024,
					18.4498,
					18.38494,
					16.3782,
					16.34726,
					16.36836,
					16.38306,
					16.68897,
					16.70828,
					16.71354,
					16.70725,
					17.3671,
					17.3619,
					17.38429,
					17.34174,
					18.47467,
					18.49306,
					18.46853,
					18.4267,
					16.36894,
					16.40158,
					16.36389,
					16.3691,
					16.70673,
					16.70327,
					16.70442,
					16.71566,
					17.34613,
					17.34998,
					17.34539,
					17.35143,
					18.43788,
					18.45342,
					18.48973,
					18.42269,
					16.42109,
					16.38308,
					16.40125,
					16.43021,
					16.74693,
					16.74622,
					16.7583,
					16.75068,
					17.37628,
					17.36256,
					17.38406,
					17.39019,
					18.46085,
					18.48175,
					18.47085,
					18.49464,
					16.40805,
					16.39534,
					16.42451,
					16.41978,
					16.70382,
					16.69355,
					16.7331,
					16.71638,
					17.34458,
					17.35168,
					17.39553,
					17.42253,
					18.41685,
					18.44414,
					18.47222,
					18.45765,
					16.38541,
					16.42113,
					16.40191,
					16.4364,
					16.73808,
					16.75667,
					16.7482,
					16.7703,
					17.39009,
					17.39673,
					17.39172,
					17.40876,
					18.49174,
					18.48383,
					18.50193,
					18.44695,
					16.4119,
					16.40084,
					16.39054,
					16.40891,
					16.72273,
					16.7651,
					16.78352,
					16.75933,
					17.35028,
					17.36683,
					17.37938,
					17.35952,
					18.47436,
					18.46884,
					18.49492,
					18.44879,
					16.48256,
					16.42664,
					16.4556,
					16.47001,
					16.78755,
					16.78712,
					16.78051,
					16.78323,
					17.41666,
					17.41424,
					17.42581,
					17.40811,
					18.50519,
					18.4591,
					18.46639,
					18.48496,
					16.46111,
					16.44568,
					16.44026,
					16.49248,
					16.76705,
					16.76869,
					16.75176,
					16.76717,
					17.3699,
					17.39484,
					17.37462,
					17.391,
					18.43502,
					18.45667,
					18.48469,
					18.44505,
					16.47184,
					16.44432,
					16.48507,
					16.46553,
					16.74619,
					16.75827,
					16.77642,
					16.80617,
					17.40144,
					17.41337,
					17.41439,
					17.42936,
					18.45557,
					18.49341,
					18.4997,
					18.51456,
					16.5146,
					16.52858,
					16.48929,
					16.4835,
					16.79318,
					16.78654,
					16.81082,
					16.79515,
					17.44757,
					17.43895,
					17.41014,
					17.41624,
					18.48484,
					18.48572,
					18.50127,
					18.52031,
					16.43456,
					16.41157,
					16.45712,
					16.44183,
					16.78418,
					16.75917,
					16.72485,
					16.73737,
					17.38,
					17.40499,
					17.38538,
					17.33634,
					18.41659,
					18.44784,
					18.4077,
					18.3998,
					16.4674,
					16.46743,
					16.4825,
					16.47389,
					16.77711,
					16.78095,
					16.79662,
					16.79207,
					17.43717,
					17.43126,
					17.43707,
					17.45412,
					18.45364,
					18.46648,
					18.48019,
					18.51079,
					16.48934,
					16.49631,
					16.50244,
					16.52752,
					16.81016,
					16.81741,
					16.85583,
					16.83427,
					17.45357,
					17.46209,
					17.46108,
					17.4783,
					18.53251,
					18.56657,
					18.53407,
					18.55528,
					16.50025,
					16.50171,
					16.50515,
					16.50377,
					16.84925,
					16.84598,
					16.87559,
					16.84838,
					17.48283,
					17.50251,
					17.49763,
					17.50414,
					18.59612,
					18.60332,
					18.54117,
					18.55515,
					16.52023,
					16.47843,
					16.48833,
					16.4916,
					16.81305,
					16.82221,
					16.84475,
					16.82325,
					17.48427,
					17.47598,
					17.43654,
					17.46228,
					18.54615,
					18.51217,
					18.52053,
					18.50377,
					16.43093,
					16.4819,
					16.46396,
					16.44992,
					16.80828,
					16.78764,
					16.80448,
					16.77961,
					17.44225,
					17.44149,
					17.44436,
					17.4546,
					18.51461,
					18.54332,
					18.50062,
					18.53271,
					16.47235,
					16.46834,
					16.46552,
					16.48889,
					16.81195,
					16.79159,
					16.80231,
					16.78583,
					17.45757,
					17.4401,
					17.43406,
					17.4101,
					18.5174,
					18.50259,
					18.5052,
					18.47005,
					16.48241,
					16.45294,
					16.45243,
					16.47477,
					16.80489,
					16.78652,
					16.80199,
					16.7962,
					17.44681,
					17.45491,
					17.42353,
					17.40499,
					18.58754,
					18.55105,
					18.53101,
					18.50195,
					16.49167,
					16.48377,
					16.49381,
					16.48461,
					16.76435,
					16.78485,
					16.76505,
					16.77506,
					17.41498,
					17.40521,
					17.41993,
					17.4379,
					18.51905,
					18.524,
					18.50387,
					18.47214,
					16.40906,
					16.44835,
					16.358,
					16.39984,
					16.74621,
					16.756,
					16.74097,
					16.73112,
					17.40643,
					17.37644,
					17.35264,
					17.36219,
					18.53969,
					18.46668,
					18.45108,
					18.46584,
					16.43851,
					16.50938,
					16.46065,
					16.46303,
					16.74796,
					16.77504,
					16.77043,
					16.78603,
					17.39961,
					17.46044,
					17.45662,
					17.43824,
					18.5397,
					18.53159,
					18.58213,
					18.59036,
					16.46312,
					16.47404,
					16.48946,
					16.53795,
					16.81338,
					16.80583,
					16.83043,
					16.83086,
					17.45864,
					17.46725,
					17.49983,
					17.45895,
					18.57785,
					18.5762,
					18.62735,
					18.59162,
					16.50053,
					16.49895,
					16.48657,
					16.54407,
					16.82873,
					16.84614,
					16.84376,
					16.82585,
					17.48479,
					17.49109,
					17.48371,
					17.49551,
					18.56642,
					18.55239,
					18.57847,
					18.59818,
					16.58542,
					16.53374,
					16.55031,
					16.56015,
					16.8878,
					16.8764,
					16.87474,
					16.8493,
					17.52097,
					17.47902,
					17.49779,
					17.46464,
					18.57088,
					18.5947,
					18.53455,
					18.51414,
					16.5835,
					16.51982,
					16.52792,
					16.52901,
					16.8722,
					16.85015,
					16.85775,
					16.84523,
					17.51407,
					17.51068,
					17.52017,
					17.49409,
					18.57627,
					18.57895,
					18.60131,
					18.50789,
					16.49363,
					16.4917,
					16.48278,
					16.49821,
					16.82972,
					16.82257,
					16.81097,
					16.82981,
					17.48675,
					17.4634,
					17.4664,
					17.50558,
					18.59863,
					18.57204,
					18.54893,
					18.57196,
					16.55851,
					16.54394,
					16.54588,
					16.50013,
					16.85378,
					16.79446,
					16.78431,
					16.82778,
					17.43773,
					17.4189,
					17.41743,
					17.46162,
					18.50891,
					18.47611,
					18.53608,
					18.5241,
					16.5621,
					16.50914,
					16.61802,
					16.53851,
					16.85114,
					16.81339,
					16.8363,
					16.81775,
					17.5119,
					17.47932,
					17.45352,
					17.48237,
					18.54848,
					18.56628,
					18.57867,
					18.51831,
					16.50193,
					16.52521,
					16.49441,
					16.5508,
					16.83897,
					16.84137,
					16.83859,
					16.83198,
					17.4976,
					17.5096,
					17.48117,
					17.49533,
					18.58115,
					18.59556,
					18.55848,
					18.53907,
					16.46025,
					16.45751,
					16.48518,
					16.47774,
					16.80513,
					16.79692,
					16.81373,
					16.81035,
					17.45537,
					17.4396,
					17.43347,
					17.44093,
					18.55019,
					18.53215,
					18.54208,
					18.4911,
					16.49964,
					16.48656,
					16.49411,
					16.51332,
					16.81322,
					16.80642,
					16.82743,
					16.7606,
					17.45101,
					17.45642,
					17.45155,
					17.4452,
					18.51098,
					18.54235,
					18.50811,
					18.47411,
					16.51673,
					16.5154,
					16.51005,
					16.54064,
					16.80526,
					16.82523,
					16.835,
					16.83069,
					17.44871,
					17.45128,
					17.44428,
					17.45967,
					18.51239,
					18.55184,
					18.52538,
					18.52141,
					16.47143,
					16.45662,
					16.47754,
					16.49662,
					16.7747,
					16.78418,
					16.80083,
					16.81957,
					17.44535,
					17.44497,
					17.42668,
					17.43403,
					18.54798,
					18.49845,
					18.55926,
					18.52314,
					16.49287,
					16.48581,
					16.47921,
					16.51038,
					16.81795,
					16.81289,
					16.84717,
					16.82059,
					17.43098,
					17.43328,
					17.42466,
					17.44448,
					18.49707,
					18.49609,
					18.50575,
					18.50203,
					16.48072,
					16.52771,
					16.48513,
					16.47506,
					16.82205,
					16.80976,
					16.80132,
					16.80955,
					17.43048,
					17.45035,
					17.42501,
					17.44101,
					18.48518,
					18.43955,
					18.47923,
					18.46548,
					16.39076,
					16.4863,
					16.52009,
					16.38192,
					16.79078,
					16.81348,
					16.80823,
					16.79097,
					17.40821,
					17.41089,
					17.3844,
					17.41711,
					18.44518,
					18.45799,
					18.42964,
					18.44883,
					16.44508,
					16.47788,
					16.47317,
					16.4448,
					16.80648,
					16.80072,
					16.79182,
					16.80829,
					17.41505,
					17.42518,
					17.41562,
					17.44761,
					18.50249,
					18.44991,
					18.44138,
					18.40718,
					16.43717,
					16.51727,
					16.49435,
					16.4904,
					16.82022,
					16.8189,
					16.81293,
					16.83263,
					17.46324,
					17.43786,
					17.4286,
					17.45999,
					18.54681,
					18.51112,
					18.54002,
					18.50186,
					16.49674,
					16.44519,
					16.4412,
					16.46814,
					16.8173,
					16.81457,
					16.80363,
					16.77975,
					17.41223,
					17.42264,
					17.38739,
					17.43177,
					18.45494,
					18.44511,
					18.46316,
					18.49032,
					16.46302,
					16.49902,
					16.48867,
					16.48243,
					16.75599,
					16.818,
					16.82154,
					16.7717,
					17.39028,
					17.45147,
					17.42764,
					17.43549,
					18.49444,
					18.53825,
					18.50834,
					18.50691,
					16.43351,
					16.43236,
					16.39863,
					16.44501,
					16.77776,
					16.7447,
					16.80821,
					16.79434,
					17.3977,
					17.43406,
					17.46645,
					17.4656,
					18.50723,
					18.50062,
					18.54041,
					18.57543,
					16.44956,
					16.42271,
					16.49084,
					16.468,
					16.78484,
					16.83843,
					16.80774,
					16.802,
					17.43075,
					17.43643,
					17.40713,
					17.45985,
					18.50493,
					18.51821,
					18.51459,
					18.50132,
					16.42976,
					16.45853,
					16.46328,
					16.43508,
					16.75147,
					16.74028,
					16.75749,
					16.73896,
					17.36501,
					17.35779,
					17.38091,
					17.39203,
					18.48274,
					18.43263,
					18.4484,
					18.4333};

        // variables for saving the parameters of the fit
        float eff_velocities_graphs = 0;
        float eff_velocities_graphs_errors = 0;
        float p2_graphs = 0;
        float p1_graphs = 0;
        float p2_graphs_error = 0;
        float p1_graphs_error = 0;
        char string[20];

	// loop over the channels, apply a quadratic fit for each one and calculate the effective velocities
        for(int m = 0; m < channels; ++m){

                sprintf(string,"h2_tgraph[%d]", m+1);

                h2_tgraph = (TGraph*)in->Get(string);

                if(h2_tgraph->GetN() > 2){
			// quadratic fit
                        h2_tgraph->Fit("pol2");
                        func2 = h2_tgraph->GetFunction("pol2");
                        p2_graphs = func2->GetParameter(2);
                        p2_graphs_error = func2->GetParError(2);
                        p1_graphs = func2->GetParameter(1);
                        p1_graphs_error = func2->GetParError(1);
                        eff_velocities_graphs = effective_velocity / (p1_graphs);
                        eff_velocities_graphs_errors = effective_velocity * p1_graphs_error / ( p1_graphs * p1_graphs );
                }

		// fill the histograms
                h1_c_eff2->Fill(m+1,eff_velocities_graphs);
                h1_c_eff2->SetBinError(m+2,eff_velocities_graphs_errors);
                h1_p2_fit_parameter->Fill(m+1, p2_graphs);
                h1_p2_fit_parameter->SetBinError(m+2, p2_graphs_error);
	
		h2_tgraph->Delete();

        } // end of loop over channels


        TCanvas *Canvas_1 = new TCanvas("Canvas_1", "Canvas_1",323,71,953,603);
        Canvas_1->Range(-100,12.25,900,19.75);
        Canvas_1->SetFillColor(0);
        Canvas_1->SetBorderMode(0);
        Canvas_1->SetBorderSize(2);
        Canvas_1->SetFrameBorderMode(0);
        Canvas_1->SetFrameBorderMode(0);


        h1_c_eff2->Draw("");

	// save results
        Canvas_1->SaveAs("h1_c_eff2.png");
        Canvas_1->SaveAs("h1_c_eff2.C");

        TCanvas *Canvas_4 = new TCanvas("Canvas_4", "Canvas_4",323,71,953,603);
        Canvas_4->Range(-100,12.25,900,19.75);
        Canvas_4->SetFillColor(0);
        Canvas_4->SetBorderMode(0);
        Canvas_4->SetBorderSize(2);
        Canvas_4->SetFrameBorderMode(0);
        Canvas_4->SetFrameBorderMode(0);

        h1_p2_fit_parameter->Draw("");

	// save results
        Canvas_4->SaveAs("h1_p2_fit_parameter.png");
        Canvas_4->SaveAs("h1_p2_fit_parameter.C");

	in->Close();

}
